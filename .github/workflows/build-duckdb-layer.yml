name: Build DuckDB Lambda Layer

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build DuckDB on Lambda Python 3.9
        run: |
          docker run --rm \
            -v "${{ github.workspace }}:/var/task" \
            public.ecr.aws/lambda/python:3.9 \
            bash -c "
              cd /var/task &&
              mkdir -p python &&
              pip install duckdb -t python &&
              zip -r duckdb-layer.zip python
            "

      - name: Upload layer zip
        uses: actions/upload-artifact@v4
        with:
          name: duckdb-layer
          path: duckdb-layer.zip

